# Jaeger Wrapper for Go

Этот пакет представляет собой обертку над оригинальным Jaeger для упрощения его использования в проектах на Go. Он предоставляет базовую функциональность для запуска и остановки Jaeger, а также для создания и управления спанами.

## Установка

Для начала работы с этим пакетом, убедитесь, что у вас установлен Go. Затем выполните следующую команду для установки:

```bash
go get git.astralnalog.ru/utils/alogger
```

## Использование

### Инициализация Jaeger

Для начала работы с Jaeger, создайте экземпляр `IJaeger` с помощью функции `NewJaeger`.

```go
ctx := context.Background()
jaeger := NewJaeger()
```

### Запуск Jaeger

Используйте метод `Start` для инициализации Jaeger. Этот метод создает конфигурацию для Jaeger и запускает трейсер.

```go
// example collectorURL: "http://jaeger-collector:14268/api/traces"
err := jaeger.Start("serviceName", "collectorURL")
if err != nil {
    log.Fatalf("Ошибка при запуске Jaeger: %v", err)
}
```

### Создание и управление спанами

Чтобы создать новый спан, используйте функцию `StartSpan`. Эта функция принимает контекст и имя спана в качестве аргументов.

```go
span, ctx := StartSpan(ctx, "exampleSpan")
defer span.Finish()
```

### Остановка Jaeger

После завершения работы с Jaeger, не забудьте остановить его, вызвав метод `Stop`.

```go
err = jaeger.Stop()
if err != nil {
    log.Fatalf("Ошибка при остановке Jaeger: %v", err)
}
```

### Локальный запуск JaegerUI

Для локального запуска понадобится docker. Достаточно запустить следующюю команду:

```docker
docker run -d --name jaeger \
 -p 16686:16686 \
 -p 14268:14268 \
 jaegertracing/all-in-one:1.22
```

Для процессоров с архитектурой arm64 нужно добавить аргумент --platform:

```docker
docker run --platform linux/arm64 -d --name jaeger \
 -p 16686:16686 \
 -p 14268:14268 \
 jaegertracing/all-in-one:1.22
```

## Конфигурация

В будущем планируется добавление возможности изменять конфигурацию через аргументы функции `Start`.

### Информация по портам
**5775:5775/udp:** Этот порт используется для протокола Zipkin, который позволяет приложениям отправлять данные трассировки в формате Zipkin.

**6831:6831/udp и 6832:6832/udp:** Эти порты используются для протокола Jaeger для приема данных трассировки. Порт 6831 обычно используется для приема данных трассировки в формате Jaeger Thrift, а порт 6832 - для приема данных в формате Jaeger Compact Thrift.

**5778:5778:** Этот порт используется для протокола gRPC, который позволяет сервисам Jaeger общаться между собой и с другими сервисами.

**16686:16686:** Порт для веб-интерфейса Jaeger UI, который предоставляет пользовательский интерфейс для просмотра и анализа данных трассировки.

**14268:14268:** Порт для Jaeger gRPC API, который позволяет приложениям отправлять данные трассировки напрямую в Jaeger через gRPC.

**9411:9411:** Порт для протокола Zipkin, который позволяет приложениям отправлять данные трассировки в формате Zipkin. Этот порт был указан в переменной окружения COLLECTOR_ZIPKIN_HTTP_PORT, что указывает на использование протокола Zipkin для приема данных трассировки через HTTP.


## Ссылки

- [Jaeger Client Go](https://pkg.go.dev/github.com/uber/jaeger-client-go)

## Контакты

Если у вас есть вопросы или предложения по улучшению этого пакета, пожалуйста, свяжитесь с нами через GitHub.